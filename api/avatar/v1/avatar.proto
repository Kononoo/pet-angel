syntax = "proto3";

package api.avatar.v1;

import "google/api/annotations.proto";

option go_package = "pet-angel/api/avatar/v1;v1";

// 虚拟形象/道具/聊天 服务
// - 模型：列出可用宠物模型并可切换
// - 道具：列出与使用（消费金币或数量的策略在服务端控制）
// - 聊天：向 AI 发送一条消息，可选返回 AI 的同步应答
service AvatarService {
  // 获取可用的宠物模型列表
  rpc GetModels(GetModelsRequest) returns (GetModelsReply) {
    option (google.api.http) = { get: "/v1/avatar/models" };
  }
  // 设置当前宠物模型
  rpc SetPetModel(SetPetModelRequest) returns (SetPetModelReply) {
    option (google.api.http) = { post: "/v1/avatar/model" body: "*" };
  }
  // 获取道具列表
  rpc GetItems(GetItemsRequest) returns (GetItemsReply) {
    option (google.api.http) = { get: "/v1/avatar/items" };
  }
  // 使用一个道具（例如喂食/玩具等）
  rpc UseItem(UseItemRequest) returns (UseItemReply) {
    option (google.api.http) = { post: "/v1/avatar/use-item" body: "*" };
  }
  // 发送一条聊天消息给 AI（同步返回本条消息；可选返回AI的即时回复）
  rpc Chat(ChatRequest) returns (ChatReply) {
    option (google.api.http) = { post: "/v1/avatar/chat" body: "*" };
  }
}

// 宠物模型
message PetModel {
  int64 id = 1;          // 模型ID
  string name = 2;       // 模型名称
  string path = 3;       // 模型资源URL（MinIO）
  int32 model_type = 4;  // 0=猫 1=狗
  bool is_default = 5;   // 是否默认
  int32 sort_order = 6;  // 排序序号
}

message GetModelsRequest {} // 无入参
message GetModelsReply { repeated PetModel models = 1; } // 模型列表

// 设置当前模型
message SetPetModelRequest { int64 model_id = 1; } // 目标模型ID
message SetPetModelReply { bool success = 1; }     // 是否成功

// 道具
message Item {
  int64 id = 1;           // 道具ID
  string name = 2;        // 道具名称
  string description = 3; // 描述文案
  string icon_path = 4;   // 图标URL
  int32 coin_cost = 5;    // 消耗金币
}
message GetItemsRequest {}                 // 无入参
message GetItemsReply { repeated Item items = 1; } // 道具列表

// 使用道具
message UseItemRequest { int64 item_id = 1; }          // 道具ID
message UseItemReply { bool success = 1; string message = 2; } // 使用结果与提示

// 聊天
message ChatRequest { string content = 1; } // 用户输入的文本内容
message ChatReply {
  int64 message_id = 1;   // 本次用户消息的ID
  string content = 2;     // 本次用户消息内容回显
  string created_at = 3;  // 发送时间 YYYY-MM-DD HH:MM:SS
  int64 ai_message_id = 4;// （可选）AI 回复的消息ID
  string ai_content = 5;  // （可选）AI 回复的文本
  string ai_created_at = 6;// （可选）AI 回复时间
} 