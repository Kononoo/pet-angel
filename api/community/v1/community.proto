syntax = "proto3";

package api.community.v1;

import "google/api/annotations.proto";

option go_package = "pet-angel/api/community/v1;v1";

// 社区服务
// - 分类：列出帖子分类
// - 帖子：列表/详情/发帖/点赞
// - 评论：列表/发表/点赞
service CommunityService {
  // 获取帖子分类列表
  rpc GetCategories(GetCategoriesRequest) returns (GetCategoriesReply) {
    option (google.api.http) = { get: "/v1/community/categories" };
  }
  // 获取帖子列表（支持分类、类型、排序筛选）
  rpc GetPostList(GetPostListRequest) returns (GetPostListReply) {
    option (google.api.http) = { get: "/v1/community/posts" };
  }
  // 获取帖子详情
  rpc GetPostDetail(GetPostDetailRequest) returns (GetPostDetailReply) {
    option (google.api.http) = { get: "/v1/community/posts/{post_id}" };
  }
  // 发布帖子（图文或视频）
  rpc CreatePost(CreatePostRequest) returns (CreatePostReply) {
    option (google.api.http) = { post: "/v1/community/posts" body: "*" };
  }
  // 点赞帖子
  rpc LikePost(LikePostRequest) returns (LikePostReply) {
    option (google.api.http) = { post: "/v1/community/posts/{post_id}/like" };
  }
  // 取消点赞帖子（POST /unlike）
  rpc UnlikePost(UnlikePostRequest) returns (UnlikePostReply) {
    option (google.api.http) = { post: "/v1/community/posts/{post_id}/unlike" };
  }
  // 获取评论列表
  rpc GetCommentList(GetCommentListRequest) returns (GetCommentListReply) {
    option (google.api.http) = { get: "/v1/community/posts/{post_id}/comments" };
  }
  // 发表评论
  rpc CreateComment(CreateCommentRequest) returns (CreateCommentReply) {
    option (google.api.http) = { post: "/v1/community/posts/{post_id}/comments" body: "*" };
  }
  // 点赞评论
  rpc LikeComment(LikeCommentRequest) returns (LikeCommentReply) {
    option (google.api.http) = { post: "/v1/community/comments/{comment_id}/like" };
  }
  // 取消点赞评论（POST /unlike）
  rpc UnlikeComment(UnlikeCommentRequest) returns (UnlikeCommentReply) {
    option (google.api.http) = { post: "/v1/community/comments/{comment_id}/unlike" };
  }
}

// 帖子分类
message Category {
  // 分类ID
  int64 id = 1;
  // 分类名称
  string name = 2;
}
message GetCategoriesRequest {}
message GetCategoriesReply {
  // 分类列表
  repeated Category categories = 1;
}

// 用户简要信息（用于帖子/评论作者）
message UserBrief {
  // 用户ID
  int64 id = 1;
  // 昵称
  string nickname = 2;
  // 头像URL
  string avatar = 3;
  // 当前登录用户是否已关注该作者
  bool is_followed = 4;
}

// 帖子实体
message Post {
  // 帖子ID
  int64 id = 1;
  // 作者信息
  UserBrief user = 2;
  // 分类ID
  int64 category_id = 3;
  // 标题
  string title = 4;
  // 文本内容
  string content = 5;
  // 帖子类型：0=图文 1=视频（与发布时保持一致）
  int32 post_type = 6;
  // 图片URL列表（图文）
  repeated string image_urls = 7;
  // 视频URL（视频）
  string video_url = 8;
  // 封面URL（可选，用于列表首帧展示）
  string cover_url = 9;
  // 位置文本（可选，例如城市/商圈）
  string locate = 10;
  // 标签（可选，最多若干个，按业务约束）
  repeated string tags = 11;
  // 点赞数
  int32 liked_count = 12;
  // 评论数
  int32 comment_count = 13;
  // 创建时间 YYYY-MM-DD HH:MM:SS
  string created_at = 14;
  // 当前用户是否已点赞
  bool is_liked = 15;
  // 是否私密（私密仅自己可见）
  bool is_private = 16;
}

// 帖子列表查询参数
message GetPostListRequest {
  // 分类过滤（可空，为0或缺省则为全部分类）
  int64 category_id = 1;
  // 帖子类型过滤：-1=全部 0=图文 1=视频（默认-1）
  int32 post_type = 2;
  // 排序字段：created=按创建时间倒序、liked=按点赞数倒序（默认created）
  string sort = 3;
  // 页码，从1开始（默认1）
  int32 page = 4;
  // 每页条数（默认20，最大100；超出按100处理）
  int32 page_size = 5;
}
message GetPostListReply {
  // 结果总条数
  int32 total = 1;
  // 当前页帖子列表
  repeated Post list = 2;
}

// 帖子详情
message GetPostDetailRequest {
  // 帖子ID
  int64 post_id = 1;
}
message GetPostDetailReply {
  // 帖子详情
  Post post = 1;
}

// 发帖
message CreatePostRequest {
  // 分类ID（可空，为0或缺省则不归类）
  int64 category_id = 1;
  // 标题（可选，建议<=50字）
  string title = 2;
  // 文本内容（当 post_type=0 时必填，建议<=1000字）
  string content = 3;
  // 帖子类型：0=图文 1=视频（默认0）
  int32 post_type = 4;
  // 图文贴：图片URL列表（最多9张，至少1张）
  repeated string image_urls = 5;
  // 视频贴：视频URL（post_type=1 时必填）
  string video_url = 6;
  // 封面URL（可选，用于列表展示）
  string cover_url = 7;
  // 位置（可选）
  string locate = 8;
  // 标签（可选）
  repeated string tags = 9;
  // 是否私密（默认false）
  bool is_private = 10;
}
message CreatePostReply {
  // 新帖ID
  int64 id = 1;
}

// 帖子点赞
message LikePostRequest {
  // 帖子ID
  int64 post_id = 1;
}
message LikePostReply {
  // 是否成功
  bool success = 1;
}
message UnlikePostRequest {
  // 帖子ID
  int64 post_id = 1;
}
message UnlikePostReply {
  // 是否成功
  bool success = 1;
}

// 评论
message Comment {
  // 评论ID
  int64 id = 1;
  // 评论者
  UserBrief user = 2;
  // 内容（建议<=500字）
  string content = 3;
  // 点赞数
  int32 liked_count = 4;
  // 创建时间 YYYY-MM-DD HH:MM:SS
  string created_at = 5;
  // 当前用户是否点赞
  bool is_liked = 6;
}
message GetCommentListRequest {
  // 帖子ID
  int64 post_id = 1;
  // 页码，从1开始（默认1）
  int32 page = 2;
  // 每页条数（默认20，最大100）
  int32 page_size = 3;
}
message GetCommentListReply {
  // 结果总条数
  int32 total = 1;
  // 当前页评论列表
  repeated Comment list = 2;
}
message CreateCommentRequest {
  int64 post_id = 1;         // 帖子ID
  string content = 2;        // 评论内容（必填，建议<=500字）
}
message CreateCommentReply {
  // 新评论ID
  int64 id = 1;
}
message LikeCommentRequest {
  // 评论ID
  int64 comment_id = 1;
}
message LikeCommentReply {
  // 是否成功
  bool success = 1;
}
message UnlikeCommentRequest {
  // 评论ID
  int64 comment_id = 1;
}
message UnlikeCommentReply {
  // 是否成功
  bool success = 1;
}